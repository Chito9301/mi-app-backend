<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Dashboard ‚Ä¢ Retos Diarios</title>
    <link rel="stylesheet" href="./styles.css" />
  </head>
  <body>
    <div class="app">
      <!-- Sidebar -->
      <aside class="sidebar" id="sidebar">
        <div class="brand">
          <div class="logo">R</div>
          <div>
            <span>Retos Diarios</span><br />
            <small style="color: var(--muted)">Panel de Control</small>
          </div>
        </div>

        <nav class="nav">
          <h4>Navegaci√≥n</h4>
          <a href="#" class="active">üìä Dashboard</a>
          <a href="#"
            >üë• Usuarios <span class="badge" id="badgeUsers">0</span></a
          >
          <a href="#">üèÜ Retos</a>
          <a href="#">‚öôÔ∏è Configuraci√≥n</a>
        </nav>
      </aside>

      <!-- Topbar -->
      <header class="topbar">
        <button class="icon-btn" onclick="toggleSidebar()">‚ò∞</button>
        <div class="search">
          üîé
          <input placeholder="Buscar usuarios, retos, promociones..." id="q" />
        </div>
        <div class="actions">
          <button class="icon-btn" title="Notificaciones">üîî</button>
          <button class="icon-btn" title="Atajos">‚ö°</button>
          <div class="icon-btn" title="Admin">üë§ Admin</div>
        </div>
      </header>

      <!-- Main -->
      <main class="main">
        <!-- KPIs -->
        <section class="kpis">
          <article class="card">
            <div class="label">Usuarios activos ahora</div>
            <div class="value" id="kpiActive">0</div>
            <div class="delta up" id="kpiActiveDelta">+0.0% vs 1h</div>
          </article>

          <article class="card">
            <div class="label">Viendo promociones</div>
            <div class="value" id="kpiPromo">0</div>
            <div class="delta" id="kpiPromoDelta">+0.0% vs 1h</div>
          </article>

          <article class="card">
            <div class="label">Premium activos</div>
            <div class="value" id="kpiPremium">0</div>
            <div class="delta up" id="kpiPremiumDelta">+0.0% vs 1h</div>
          </article>

          <article class="card">
            <div class="label">Retos ejecutados hoy</div>
            <div class="value" id="kpiChallenges">0</div>
            <div class="delta" id="kpiChallengesDelta">+0.0% vs ayer</div>
          </article>
        </section>

        <!-- Charts & Filters -->
        <section class="grid-2">
          <article class="card">
            <div class="panel-title">
              <h3>Evoluci√≥n de usuarios (activos / premium / promo)</h3>
              <div class="filters">
                <select class="select" id="range">
                  <option value="1h">√ölt. 1h</option>
                  <option value="24h" selected>√ölt. 24h</option>
                  <option value="7d">√ölt. 7 d√≠as</option>
                </select>
                <button class="btn" id="refresh">Actualizar</button>
              </div>
            </div>
            <div class="chart" id="chart">
              <span>Gr√°fico lineal (SVG) ‚Äî sin dependencias</span>
            </div>
          </article>

          <article class="card">
            <div class="panel-title">
              <h3>Filtros</h3>
              <div class="filters">
                <select class="select" id="seg">
                  <option value="all">Todos</option>
                  <option value="active">Activos</option>
                  <option value="promo">Promoci√≥n</option>
                  <option value="premium">Premium</option>
                </select>
                <button class="btn primary" id="apply">Aplicar</button>
              </div>
            </div>
            <div>
              <p style="color: var(--muted); margin-top: 0">
                Segmenta por estado para acotar la tabla de usuarios.
              </p>
              <ul style="margin: 0 0 8px 18px; color: var(--muted)">
                <li>Activos ahora</li>
                <li>En promoci√≥n actualmente</li>
                <li>Con suscripci√≥n premium</li>
              </ul>
            </div>
          </article>
        </section>

        <!-- Table -->
        <section class="card" style="margin-top: 14px">
          <div class="panel-title">
            <h3>Usuarios activos (detalle)</h3>
            <div class="filters">
              <input
                class="select"
                placeholder="Buscar por nombre..."
                id="searchName"
              />
              <button class="btn" id="clear">Limpiar</button>
            </div>
          </div>

          <table class="table" id="usersTable">
            <thead>
              <tr>
                <th>Nombre</th>
                <th>Estado</th>
                <th>√öltimo reto</th>
                <th>Premium</th>
                <th>Viendo promo</th>
                <th>√öltima actividad</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </section>
      </main>
    </div>

    <script>
      // ===== Mock data generator (no modifica tu backend) =====
      const state = {
        now: Date.now(),
        users: [],
        series: { active: [], premium: [], promo: [] },
      };

      function rnd(n = 1) {
        return Math.round(Math.random() * n);
      }
      function genUsers(n = 32) {
        const names = [
          "Ana",
          "Luis",
          "Carla",
          "Diego",
          "Marta",
          "Leo",
          "Nora",
          "Iv√°n",
          "Sof√≠a",
          "Pablo",
          "Elena",
          "Ra√∫l",
          "Cami",
          "Gaby",
          "Noa",
          "Isis",
          "Tadeo",
          "Julia",
          "Rub√©n",
          "Val",
          "Luz",
          "Vitor",
        ];
        const retos = [
          "Plancha 60s",
          "Correr 5km",
          "Leer 10p",
          "Hidrataci√≥n",
          "Meditaci√≥n 5m",
          "Yoga",
          "Respirar 4-7-8",
          "Flexiones 20",
          "Squats 30",
        ];
        state.users = Array.from({ length: n }).map((_, i) => {
          const premium = Math.random() < 0.32;
          const promo = Math.random() < 0.28;
          const active = Math.random() < 0.65;
          return {
            name: `${names[rnd(names.length - 1)]} ${["A.", "B.", "C.", "D.", "E."][rnd(4)]}`,
            premium,
            promo,
            active,
            lastChallenge: retos[rnd(retos.length - 1)],
            lastSeen: new Date(
              Date.now() - rnd(3600) * 1000,
            ).toLocaleTimeString(),
          };
        });
      }
      function genSeries(points = 48) {
        const push = (arr, v) => arr.push(v < 0 ? 0 : v);
        state.series.active = [];
        state.series.premium = [];
        state.series.promo = [];
        let a = 40 + rnd(20),
          p = 12 + rnd(8),
          pr = 10 + rnd(10);
        for (let i = 0; i < points; i++) {
          a += (Math.random() - 0.5) * 8;
          p += (Math.random() - 0.5) * 3;
          pr += (Math.random() - 0.5) * 4;
          push(state.series.active, Math.round(a));
          push(state.series.premium, Math.round(p));
          push(state.series.promo, Math.round(pr));
        }
      }

      function kpis() {
        const active = state.users.filter((u) => u.active).length;
        const promo = state.users.filter((u) => u.promo).length;
        const premium = state.users.filter((u) => u.premium).length;
        document.getElementById("kpiActive").textContent = active;
        document.getElementById("kpiPromo").textContent = promo;
        document.getElementById("kpiPremium").textContent = premium;
        document.getElementById("kpiChallenges").textContent = Math.round(
          active * 1.2 + rnd(20),
        );
        document.getElementById("badgeUsers").textContent = state.users.length;
      }

      function drawChart() {
        const el = document.getElementById("chart");
        const w = el.clientWidth - 20,
          h = el.clientHeight - 20,
          pad = 16;
        const maxY =
          Math.max(
            ...state.series.active,
            ...state.series.premium,
            ...state.series.promo,
          ) * 1.2;
        const toXY = (v, i, len) => [
          pad + i * ((w - 2 * pad) / (len - 1)),
          h - pad - (v / maxY) * (h - 2 * pad),
        ];
        const path = (arr) => {
          return arr
            .map(
              (v, i) =>
                (i ? "L" : "M") +
                toXY(v, i, arr.length)
                  .map((n) => n.toFixed(1))
                  .join(","),
            )
            .join(" ");
        };
        const svg = `
        <svg width="${w}" height="${h}" viewBox="0 0 ${w} ${h}">
          <defs>
            <linearGradient id="g1" x1="0" x2="0" y1="0" y2="1">
              <stop offset="0%" stop-color="var(--brand)" stop-opacity=".8"/>
              <stop offset="100%" stop-color="var(--brand)" stop-opacity=".1"/>
            </linearGradient>
            <linearGradient id="g2" x1="0" x2="0" y1="0" y2="1">
              <stop offset="0%" stop-color="var(--brand-2)" stop-opacity=".8"/>
              <stop offset="100%" stop-color="var(--brand-2)" stop-opacity=".1"/>
            </linearGradient>
            <linearGradient id="g3" x1="0" x2="0" y1="0" y2="1">
              <stop offset="0%" stop-color="var(--accent)" stop-opacity=".8"/>
              <stop offset="100%" stop-color="var(--accent)" stop-opacity=".1"/>
            </linearGradient>
          </defs>
          <g fill="none" stroke-width="2.2">
            <path d="${path(state.series.active)}" stroke="var(--brand)"/>
            <path d="${path(state.series.premium)}" stroke="var(--brand-2)"/>
            <path d="${path(state.series.promo)}" stroke="var(--accent)"/>
          </g>
        </svg>`;
        el.innerHTML = svg;
      }

      function renderTable() {
        const seg = document.getElementById("seg").value;
        const q = (
          document.getElementById("searchName").value || ""
        ).toLowerCase();
        const tbody = document.querySelector("#usersTable tbody");
        tbody.innerHTML = "";
        state.users
          .filter(
            (u) =>
              seg === "all" ||
              (seg === "active" && u.active) ||
              (seg === "promo" && u.promo) ||
              (seg === "premium" && u.premium),
          )
          .filter((u) => u.name.toLowerCase().includes(q))
          .slice(0, 50)
          .forEach((u) => {
            const tr = document.createElement("tr");
            tr.innerHTML = `
            <td>${u.name}</td>
            <td><span class="status ${u.active ? "active" : ""}">${u.active ? "Activo" : "Inactivo"}</span></td>
            <td>${u.lastChallenge}</td>
            <td>${u.premium ? "S√≠" : "No"}</td>
            <td>${u.promo ? "S√≠" : "No"}</td>
            <td>${u.lastSeen}</td>`;
            tbody.appendChild(tr);
          });
      }

      function tick() {
        // simulate small changes
        if (Math.random() < 0.5) {
          const i = Math.floor(Math.random() * state.users.length);
          state.users[i].active = !state.users[i].active;
        }
        kpis();
        renderTable();
      }

      // Events
      document.getElementById("refresh").onclick = () => {
        genSeries();
        drawChart();
      };
      document.getElementById("apply").onclick = renderTable;
      document.getElementById("searchName").oninput = renderTable;
      document.getElementById("clear").onclick = () => {
        document.getElementById("searchName").value = "";
        renderTable();
      };

      function toggleSidebar() {
        document.getElementById("sidebar").classList.toggle("open");
      }

      // Init
      genUsers(42);
      genSeries();
      kpis();
      drawChart();
      renderTable();
      setInterval(tick, 2000);
      window.addEventListener("resize", drawChart);
    </script>
  </body>
</html>
